<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Monitoring Pajak Kendaraan Dinas</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

html{
font-size: clamp(14px,1.1vw,18px);
}

body{
background-color:#ffe066;
background-image:
radial-gradient(circle at 20% 20%, rgba(255,255,255,0.2), transparent 40%),
radial-gradient(circle at 80% 80%, rgba(0,0,0,0.05), transparent 40%);
}

.card-box{
background:white;
padding:20px;
border-radius:12px;
box-shadow:0 4px 15px rgba(0,0,0,0.15);
margin-bottom:25px;
}

.status-aman{background:#d4edda;}
.status-perhatian{background:#fff3cd;}
.status-mendesak{background:#f8d7da;}

table{white-space:nowrap;}

</style>
</head>

<body class="container-fluid py-3">

<div class="card-box text-center">

<strong>KEJAKSAAN AGUNG RI</strong><br>
KEJAKSAAN TINGGI GORONTALO<br>
KEJAKSAAN NEGERI BONE BOLANGO<br>

<h3 class="mt-3">üöó Monitoring Kendaraan Dinas</h3>

</div>


<button class="btn btn-primary mb-3"
data-bs-toggle="modal"
data-bs-target="#modalForm">

+ Tambah Kendaraan

</button>


<!-- RODA 4 -->

<div class="card-box">

<h5>üöó Kendaraan Roda 4</h5>

<div class="table-responsive">

<table class="table table-bordered table-striped text-center">

<thead class="table-dark">

<tr>
<th>No</th>
<th>No Polisi</th>
<th>Merek</th>
<th>Pajak</th>
<th>Sisa Pajak</th>
<th>TNKB</th>
<th>Sisa TNKB</th>
<th>Status</th>
<th>Aksi</th>
</tr>

</thead>

<tbody id="tableR4"></tbody>

</table>

</div>

</div>



<!-- RODA 2 -->

<div class="card-box">

<h5>üèçÔ∏è Kendaraan Roda 2</h5>

<div class="table-responsive">

<table class="table table-bordered table-striped text-center">

<thead class="table-dark">

<tr>
<th>No</th>
<th>No Polisi</th>
<th>Merek</th>
<th>Pajak</th>
<th>Sisa Pajak</th>
<th>TNKB</th>
<th>Sisa TNKB</th>
<th>Status</th>
<th>Aksi</th>
</tr>

</thead>

<tbody id="tableR2"></tbody>

</table>

</div>

</div>



<div class="card-box">

<h5 class="text-center">üìä Statistik</h5>

<canvas id="statusChart"></canvas>

</div>



<!-- MODAL -->

<div class="modal fade" id="modalForm">

<div class="modal-dialog">

<div class="modal-content">

<div class="modal-header">
<h5>Form Kendaraan</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">

<form id="formKendaraan">

<select id="kategori" class="form-control mb-2" required>
<option value="">Pilih Jenis</option>
<option value="Roda 4">Roda 4</option>
<option value="Roda 2">Roda 2</option>
</select>

<input id="nopol" class="form-control mb-2" placeholder="Nomor Polisi" required>

<input id="merek" class="form-control mb-2" placeholder="Merek" required>

<label>Pajak</label>
<input type="date" id="pajak" class="form-control mb-2" required>

<label>TNKB</label>
<input type="date" id="tnkb" class="form-control mb-3" required>

<button class="btn btn-success w-100">Simpan</button>

</form>

</div>
</div>
</div>
</div>



<script>

const form = document.getElementById("formKendaraan");

let kendaraan =
JSON.parse(localStorage.getItem("kendaraan")) || [];

let editIndex = -1;



function hitungSisaHari(tanggal){

let today = new Date();
let target = new Date(tanggal);

return Math.ceil((target - today)/(1000*60*60*24));

}



function tampilSisa(s){

return s<0
? "Lewat "+Math.abs(s)+" hari"
: s+" hari lagi";

}



function tentukanStatus(pajak, tnkb){

if(pajak<0 || tnkb<0) return "Mendesak";

if(pajak<=30 || tnkb<=30) return "Perhatian";

return "Aman";

}



function renderTable(){

let r4 = document.getElementById("tableR4");
let r2 = document.getElementById("tableR2");

r4.innerHTML="";
r2.innerHTML="";

let aman=0, perhatian=0, mendesak=0;
let noR4=1, noR2=1;


kendaraan.forEach((k,i)=>{

let sPajak = hitungSisaHari(k.pajak);
let sTNKB = hitungSisaHari(k.tnkb);

let status = tentukanStatus(sPajak, sTNKB);


if(status==="Aman") aman++;
else if(status==="Perhatian") perhatian++;
else mendesak++;


let rowClass =
status==="Aman"
? "status-aman"
: status==="Perhatian"
? "status-perhatian"
: "status-mendesak";


let row = `
<tr class="${rowClass}">

<td>${k.kategori==="Roda 4"?noR4++:noR2++}</td>

<td>${k.nopol}</td>

<td>${k.merek}</td>

<td>${k.pajak}</td>

<td>${tampilSisa(sPajak)}</td>

<td>${k.tnkb}</td>

<td>${tampilSisa(sTNKB)}</td>

<td><strong>${status}</strong></td>

<td>

<button class="btn btn-warning btn-sm"
onclick="editData(${i})">Edit</button>

<button class="btn btn-danger btn-sm"
onclick="hapusData(${i})">Hapus</button>

</td>

</tr>
`;

if(k.kategori==="Roda 4") r4.innerHTML+=row;
else r2.innerHTML+=row;

});


updateChart(aman, perhatian, mendesak);

}



function editData(i){

let k = kendaraan[i];

kategori.value=k.kategori;
nopol.value=k.nopol;
merek.value=k.merek;
pajak.value=k.pajak;
tnkb.value=k.tnkb;

editIndex=i;

new bootstrap.Modal(
document.getElementById("modalForm")
).show();

}



function hapusData(i){

if(confirm("Hapus data?")){

kendaraan.splice(i,1);

save();

}

}



function save(){

localStorage.setItem(
"kendaraan",
JSON.stringify(kendaraan)
);

renderTable();

}



form.onsubmit = function(e){

e.preventDefault();

let data={

kategori:kategori.value,
nopol:nopol.value,
merek:merek.value,
pajak:pajak.value,
tnkb:tnkb.value

};

if(editIndex==-1)
kendaraan.push(data);

else{

kendaraan[editIndex]=data;
editIndex=-1;

}

save();

form.reset();

bootstrap.Modal
.getInstance(document.getElementById("modalForm"))
.hide();

};



let chart;

function updateChart(a,p,m){

let ctx =
document.getElementById("statusChart");

if(chart) chart.destroy();

chart = new Chart(ctx,{

type:"pie",

data:{

labels:["Aman","Perhatian","Mendesak"],

datasets:[{

data:[a,p,m],

backgroundColor:[
"#28a745",
"#ffc107",
"#dc3545"
]

}]

}

});

}



renderTable();

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>